<!DOCTYPE html>

<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/default}">

<head>
<title>[[#{left.006}]]</title>
</head>
<div layout:fragment="content">
	<div class="card mb-3">
		<div class="bg-holder d-none d-lg-block bg-card"
			style="background-image: url(/assets/img/illustrations/corner-4.png);">
		</div>
		<div class="card-header pb-1">
			<div class="row flex-between-end">
				<div class="col-auto col-lg align-self-center">
                  <h4 class="mb-0 title-area" data-anchor="data-anchor" id="tooltips">[[#{left.006}]]</h4>
                </div>
			</div>
		</div>
		<div class="card-body pt-0">
			<div class="row flex-between-center">
				<div class="col-sm-auto mb-2 mb-sm-0">
					<h6 class="mb-0">[[#{txt.recent.time}]] <span class="text-500" id="recentDtim"></span></h6>
				</div>
				<div class="col-sm-auto">
					<div class="row gx-2 align-items-center">
						<div class="col-auto">
							<select id="projectNameItemDropdown" class="form-select picker"
								data-live-search="true">
								<option value="">[[#{select.project.select}]]</option>
							</select>
						</div>
						<div class="col-auto">
							<select id="countDropdown" class="form-select picker"
								data-live-search="true">
								<!-- <option value="">[[#{select.perform.select}]]</option>
								<option value="7">[[#{select.perform.select.001}]]</option>
								<option value="15">[[#{select.perform.select.001}]]</option>
								<option value="30">[[#{select.perform.select.001}]]</option> -->

								<option value="all">[[#{select.perform.select}]]</option>
								<option value="oneday">[[#{select.perform.select.001}]]</option>
								<option value="oneweek">[[#{select.perform.select.002}]]</option>
								<option value="onemonth">[[#{select.perform.select.003}]]</option>
								<option value="onequarter">[[#{select.perform.select.004}]]</option>
								<option value="onehalf">[[#{select.perform.select.005}]]</option>
								<option value="oneyear">[[#{select.perform.select.006}]]</option>
							</select>
						</div>
						<div class="col-auto pe-0">
							<div class="input-group">
								<div class="input-group-append">
									<button type="button" id="goReport" class="btn btn-primary" disabled>[[#{button.report}]]</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row g-3 mb-3">
		<div class="col-lg-6">
			<div class="card">
				<div class="card-header">
					<div class="row flex-between-end">
						<div class="col-auto col-lg align-self-center">
							<h5 class="mb-0" data-anchor="data-anchor" id="bar-chart">
								<a class="anchorjs-link " aria-label="Anchor"
									data-anchorjs-icon="#" href="#bar-chart"
									style="padding-left: 0.375em;">[[#{txt.distribution.stability.indicator}]]</a>
							</h5>
						</div>
					</div>
				</div>
				<div class="card-body bg-light">
					<div class="tab-content">
						<div id="psiChart" style="min-height: 250px;"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-lg-6">
			<div class="card">
				<div class="card-header">
					<div class="row flex-between-end">
						<div class="col-auto col-lg align-self-center">
							<h5 class="mb-0" data-anchor="data-anchor" id="bar-chart">
								<a class="anchorjs-link " aria-label="Anchor"
									data-anchorjs-icon="#" href="#bar-chart"
									style="padding-left: 0.375em;">[[#{txt.data.count}]]</a>
							</h5>
						</div>
					</div>
				</div>
				<div class="card-body bg-light">
					<div class="tab-content">
						<div id="dataCntChart" style="min-height: 250px;"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row g-3 mb-3">
		<div class="col-lg-6">
			<div class="card">
				<div class="card-header">
					<div class="row flex-between-end">
						<div class="col-auto col-lg align-self-center">
							<h5 class="mb-0" data-anchor="data-anchor" id="bar-chart">
								<a class="anchorjs-link " aria-label="Anchor"
									data-anchorjs-icon="#" href="#bar-chart"
									style="padding-left: 0.375em;">[[#{txt.anomaly.count}]]</a>
							</h5>
						</div>
					</div>
				</div>
				<div class="card-body bg-light">
					<div class="tab-content">
						<div id="dashItemBar" style="min-height: 250px;"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-lg-6">
			<div class="card">
				<div class="card-header">
					<div class="row flex-between-end">
						<div class="col-auto col-lg align-self-center">
							<h5 class="mb-0" data-anchor="data-anchor" id="bar-chart">
								<a class="anchorjs-link " aria-label="Anchor"
									data-anchorjs-icon="#" href="#bar-chart"
									style="padding-left: 0.375em;">[[#{txt.distribution.anomaly.count}]]</a>
							</h5>
						</div>
					</div>
				</div>
				<div class="card-body bg-light">
					<div class="tab-content">
						<div id="dashChisqBar" style="min-height: 250px;"></div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		var $projectNameItemDropdown = $("#projectNameItemDropdown");
		var $countDropdown = $("#countDropdown");
		var $report = $("#goReport");
		var projectName = "";
		var recentPeriod = "all";

		$(function() {
			fn_projectNames();
			fn_Event();
		});

		function fn_Event() {
			$countDropdown.off().on('change', function() {
				recentPeriod = $(this).val();
				fn_data();
			});
			$report.off().on('click', function() {
				var param = {
						projectName : projectName,
						recentDtim : $("#recentDtim").html()
				}				
				$("#paramForm").prop('action','/result/dataReport');
				$("#paramData").val(JSON.stringify(param));
				$("#paramForm").submit(); 
			});
		}

		function fn_projectNames() {
			ajaxCall({
				target : "PROJECT_NAMES",
				url : "/result/projectnames/",
				isLoading : false
			});
		}

		function fn_data() {
			ajaxCall({
				target : "RECENTDTIM",
				url : "/main/regdtim/" + projectName,
				isLoading : false
			});
		}

		function callback(target, data) {
			switch (target) {
			case "PROJECT_NAMES":
				var listName = data;
				var html = "";

				$.each(listName, function(index, data) {
					html += "<option value="+data+">" + data + "</option>";
				});
				$projectNameItemDropdown.append(html);
				$projectNameItemDropdown.off().on(
						'change',
						function() {
							projectName = $(this).val();
							
							gf_IsNull(projectName)							
								? $report.prop('disabled',true)
								: $report.prop('disabled', false);

							fn_data();
						});
				$('.picker').select2();

				fn_data();

				break;
			case "RECENTDTIM":
				$("#recentDtim").html(data[0]);

				ajaxCall({
					target : "STAT",
					url : "/main/stat/" + projectName + "/" + recentPeriod
				});
				break;
			case "STAT":
				var statData = {
					"dtims" : [],
					"psis" : [],
					"cars" : [],
					"chisqcnts" : [],
					"datacnts" : []
				};
				$.each(data, function() {
					statData.dtims.push(this.dtim);
					statData.psis.push(parseFloat(this.psi));
					statData.cars.push(parseInt(this.car));
					statData.chisqcnts.push(parseInt(this.chisqcnt));
					statData.datacnts.push(parseInt(this.inputDataCnt));
				});
				fn_PsiChart(statData); // 분포 안정 지표

				// 데이터 수 
				var param = {
					target : "dataCntChart",
					title : '[[#{txt.data.count}]]',
					xData : statData.dtims,
					yData : statData.datacnts,
					name : '[[#{txt.number.count}]]',
					color : utils.getColors().primary,

				}
				fn_LineChart(param)

				// 일별 이상항목수 
				param.target = "dashItemBar";
				param.title = '[[#{txt.anomaly.count}]]';
				param.xData = statData.dtims;
				param.yData = statData.cars;
				param.name = '[[#{txt.item.count}]]';
				param.barColor = utils.getColors().danger
				fn_BarChart(param)

				// 분포 이상 항목수				
				param.target = "dashChisqBar";
				param.title = '[[#{txt.distribution.anomaly.count}]]';
				param.xData = statData.dtims;
				param.yData = statData.chisqcnts;
				param.barColor = utils.getColors().primary;
				fn_BarChart(param);

				break;
			default:
				break;
			}
		}
	</script>
</div>
</html>